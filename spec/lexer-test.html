<!DOCTYPE html>
<head>
	<title>Lexer Test</title>
    <link rel="stylesheet" href="qunit.css">
</head>
<body>
	
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <script src="qunit.js"></script>
    <script type="text/javascript" src="../script/lexer.js"></script>
    
	<script type="text/javascript">
        
        test("Whitespace", function(){
            var lexer = new jzt.lexer.Lexer('  \r\t\t \t  ');
            ok(lexer.nextToken() === undefined, 'No tokens expected'); 
        });
        
        test("Words", function(){
            var lexer = new jzt.lexer.Lexer('hello world a a9bc and_so _ _ok');
            deepEqual(lexer.nextToken(), {position: 0, line: 1, column: 1, name: 'WORD', value: 'hello'}, 'hello');
            deepEqual(lexer.nextToken(), {position: 6, line: 1, column: 7, name: 'WORD', value: 'world'}, 'world');
            deepEqual(lexer.nextToken(), {position: 12, line: 1, column: 13, name: 'WORD', value: 'a'}, 'a');
            deepEqual(lexer.nextToken(), {position: 14, line: 1, column: 15, name: 'WORD', value: 'a9bc'}, 'a9bc');
            deepEqual(lexer.nextToken(), {position: 19, line: 1, column: 20, name: 'WORD', value: 'and_so'}, 'and_so');
            deepEqual(lexer.nextToken(), {position: 26, line: 1, column: 27, name: 'WORD', value: '_'}, '_');
            deepEqual(lexer.nextToken(), {position: 28, line: 1, column: 29, name: 'WORD', value: '_ok'}, '_ok');
            ok(lexer.nextToken() === undefined, 'No more tokens expected');
        });
        
        test("Number", function(){
            var lexer = new jzt.lexer.Lexer('500 1 002 4abc'); 
            deepEqual(lexer.nextToken(), {position: 0, line: 1, column: 1, name: 'NUMBER', value: 500}, '500');
            deepEqual(lexer.nextToken(), {position: 4, line: 1, column: 5, name: 'NUMBER', value: 1}, '1');
            deepEqual(lexer.nextToken(), {position: 6, line: 1, column: 7, name: 'NUMBER', value: 2}, '002');
            deepEqual(lexer.nextToken(), {position: 10, line: 1, column: 11, name: 'NUMBER', value: 4}, '4');
            deepEqual(lexer.nextToken(), {position: 11, line: 1, column: 12, name: 'WORD', value: 'abc'}, 'abc');
            ok(lexer.nextToken() === undefined, 'No more tokens expected');
        });
        
        test("New lines", function(){
            var lexer = new jzt.lexer.Lexer('test \n 5 \ntest\n5\n \t\t\n\n6');
            deepEqual(lexer.nextToken(), {position: 0, line: 1, column: 1, name: 'WORD', value: 'test'}, 'token 1');
            deepEqual(lexer.nextToken(), {position: 5, line: 1, column: 6, name: 'NEWLINE', value: '[New Line]'}, 'token 2');
            deepEqual(lexer.nextToken(), {position: 7, line: 2, column: 2, name: 'NUMBER', value: 5}, 'token 3');
            deepEqual(lexer.nextToken(), {position: 9, line: 2, column: 4, name: 'NEWLINE', value: '[New Line]'}, 'token 4');
            deepEqual(lexer.nextToken(), {position: 10, line: 3, column: 1, name: 'WORD', value: 'test'}, 'token 5');
            deepEqual(lexer.nextToken(), {position: 14, line: 3, column: 5, name: 'NEWLINE', value: '[New Line]'}, 'token 6');
            deepEqual(lexer.nextToken(), {position: 15, line: 4, column: 1, name: 'NUMBER', value: 5}, 'token 7');
            deepEqual(lexer.nextToken(), {position: 16, line: 4, column: 2, name: 'NEWLINE', value: '[New Line]'}, 'token 8');
            deepEqual(lexer.nextToken(), {position: 20, line: 5, column: 4, name: 'NEWLINE', value: '[New Line]'}, 'token 9');
            deepEqual(lexer.nextToken(), {position: 21, line: 6, column: 1, name: 'NEWLINE', value: '[New Line]'}, 'token 10');
            deepEqual(lexer.nextToken(), {position: 22, line: 7, column: 1, name: 'NUMBER', value: 6}, 'token 11');
            ok(lexer.nextToken() === undefined, 'No more tokens expected');
        });
	
        test("Comments", function(){
            var lexer = new jzt.lexer.Lexer('hello world\n//hello world\nhello //world\n//\n/', false);
            deepEqual(lexer.nextToken(), {position: 0, line: 1, column: 1, name: 'WORD', value: 'hello'}, 'token 1');
            deepEqual(lexer.nextToken(), {position: 6, line: 1, column: 7, name: 'WORD', value: 'world'}, 'token 2');
            deepEqual(lexer.nextToken(), {position: 11, line: 1, column: 12, name: 'NEWLINE', value: '[New Line]'}, 'token 3');
            deepEqual(lexer.nextToken(), {position: 12, line: 2, column: 1, name: 'COMMENT', value: 'hello world'}, 'token 4');
            deepEqual(lexer.nextToken(), {position: 25, line: 2, column: 14, name: 'NEWLINE', value: '[New Line]'}, 'token 5');
            deepEqual(lexer.nextToken(), {position: 26, line: 3, column: 1, name: 'WORD', value: 'hello'}, 'token 6');
            deepEqual(lexer.nextToken(), {position: 32, line: 3, column: 7, name: 'COMMENT', value: 'world'}, 'token 7');
            deepEqual(lexer.nextToken(), {position: 39, line: 3, column: 14, name: 'NEWLINE', value: '[New Line]'}, 'token 8');
            deepEqual(lexer.nextToken(), {position: 40, line: 4, column: 1, name: 'COMMENT', value: ''}, 'token 9');
            deepEqual(lexer.nextToken(), {position: 42, line: 4, column: 3, name: 'NEWLINE', value: '[New Line]'}, 'token 10');
            throws(function(){lexer.nextToken()}, /Unrecognized token on line 5, column 1/, 'Incomplete comment character');
        });
        
        test("Strings", function() {
            var lexer = new jzt.lexer.Lexer('test "test ok" "test \\"another\\" ok" "test\\nok" "test\ntest"');
            deepEqual(lexer.nextToken(), {position: 0, line: 1, column: 1, name: 'WORD', value: 'test'}, 'token 1');
            deepEqual(lexer.nextToken(), {position: 5, line: 1, column: 6, name: 'STRING', value: 'test ok'}, 'token 2');
            deepEqual(lexer.nextToken(), {position: 15, line: 1, column: 16, name: 'STRING', value: 'test \"another\" ok'}, 'token 3');
            deepEqual(lexer.nextToken(), {position: 37, line: 1, column: 38, name: 'STRING', value: 'test\nok'}, 'token 4');
            throws(function(){lexer.nextToken()}, /Unterminated string literal/, 'Expected unterminated string literal');
        });
        
        test("Operators", function() {
            var lexer = new jzt.lexer.Lexer('< > <= >= = ><= *');
            deepEqual(lexer.nextToken(), {position: 0, line: 1, column: 1, name: 'OPERATOR', value: '<'}, 'token 1');
            deepEqual(lexer.nextToken(), {position: 2, line: 1, column: 3, name: 'OPERATOR', value: '>'}, 'token 2');
            deepEqual(lexer.nextToken(), {position: 4, line: 1, column: 5, name: 'OPERATOR', value: '<='}, 'token 3');
            deepEqual(lexer.nextToken(), {position: 7, line: 1, column: 8, name: 'OPERATOR', value: '>='}, 'token 4');
            deepEqual(lexer.nextToken(), {position: 10, line: 1, column: 11, name: 'OPERATOR', value: '='}, 'token 5');
            deepEqual(lexer.nextToken(), {position: 12, line: 1, column: 13, name: 'OPERATOR', value: '>'}, 'token 6');
            deepEqual(lexer.nextToken(), {position: 13, line: 1, column: 14, name: 'OPERATOR', value: '<='}, 'token 7');
            throws(function(){lexer.nextToken()}, /Unrecognized token/, 'Expected unrecognized token');
        });
        
        test("Punctuation", function() {
            var lexer = new jzt.lexer.Lexer(', ,,');
            deepEqual(lexer.nextToken(), {position: 0, line: 1, column: 1, name: 'PUNCTUATION', value: ','}, 'token 1');
            deepEqual(lexer.nextToken(), {position: 2, line: 1, column: 3, name: 'PUNCTUATION', value: ','}, 'token 2');
            deepEqual(lexer.nextToken(), {position: 3, line: 1, column: 4, name: 'PUNCTUATION', value: ','}, 'token 3');
            ok(lexer.nextToken() === undefined, 'No more tokens expected');
        });
        
	</script>
	
</body>