<!DOCTYPE html>
<html>
	<head>
		<title>JZT</title>
		<style type="text/css">
			#jzt {
				position: relative;
			}
			#customizers {
				position: absolute;
				top: 0;
				right: 0;
				background-color: blue;
				width: 25%;
				height: 100%;
				color: white;
			}
			textarea {
				font-family: monospace;
			}
			#edit-area {
				overflow: scroll;
				width: 640px;
				height: 480px;
			}
			#color-customizer ol {
				list-style: none;
				margin: 5px;
				padding: 0;
			}
			#color-customizer ol li {
				display: inline-block;
				width: 0;
				height: 32px;
				overflow: hidden;
				padding-left: 16px;
				border: 1px solid blue;
			}
			#color-customizer ol li.active {
				border: 2px solid #5555FF;
			}
			li.color9 {background-color: #5555FF;}
			li.colorA {background-color: #55FF55;}
			li.colorB {background-color: #55FFFF;}
			li.colorC {background-color: #FF5555;}
			li.colorD {background-color: #FF55FF;}
			li.colorE {background-color: #FFFF55;}
			li.colorF {background-color: #FFFFFF;}
		</style>
	</head>
	<body>
		
		<header>
			<!--<h1>Mark's Test Thing</h1>-->
		</header>
		
		<div id="edit-area">
		</div>

		<div id="toolbox">

			<label><input type="radio" name="activeTemplate" value="" />Nothing</label>
			<label><input type="radio" name="activeTemplate" value="Player">Player</label>
			<label><input type="radio" name="activeTemplate" value="Wall" />Wall</label>
			<label><input type="radio" name="activeTemplate" value="SolidWall" />Solid Wall</label>
			<label><input type="radio" name="activeTemplate" value="LineWall" />Line</label>
			<label><input type="radio" name="activeTemplate" value="InvisibleWall" />Invisible Wall</label>
			<label><input type="radio" name="activeTemplate" value="BreakableWall" />Breakable Wall</label>
			<label><input type="radio" name="activeTemplate" value="FakeWall" />Fake Wall</label>
			<label><input type="radio" name="activeTemplate" value="SpiderWeb" />Spider Web</label>
			<br/>
			<label><input type="radio" name="activeTemplate" value="Water" />Water</label>
			<label><input type="radio" name="activeTemplate" value="Forest" />Forest</label>
			<label><input type="radio" name="activeTemplate" value="Ricochet" />Ricochet</label>
			<label><input type="radio" name="activeTemplate" value="Door" />Door</label>
			<br/>
			<label><input type="radio" name="activeTemplate" value="Boulder" />Boulder</label>
			<label><input type="radio" name="activeTemplate" value="SliderNs" />Slider (North/South)</label>
			<label><input type="radio" name="activeTemplate" value="SliderEw" />Slider (East/West)</label>
			<br/>
			<label><input type="radio" name="activeTemplate" value="Teleporter" />Teleporter</label>
			<label><input type="radio" name="activeTemplate" value="Passage" />Passage</label>
			<label><input type="radio" name="activeTemplate" value="River" />River</label>
			<label><input type="radio" name="activeTemplate" value="Blinker" />Blinker</label>
			<br/>
			<label><input type="radio" name="activeTemplate" value="Gem" />Gem</label>
			<label><input type="radio" name="activeTemplate" value="Ammo" />Ammo</label>
			<label><input type="radio" name="activeTemplate" value="Torch" />Torch</label>
			<label><input type="radio" name="activeTemplate" value="Key" />Key</label>
			<label><input type="radio" name="activeTemplate" value="Bomb" />Bomb</label>
			<br/>
			<lable><input type="radio" name="activeTemplate" value="Pusher" />Pusher</label>
			<label><input type="radio" name="activeTemplate" value="Lion" />Lion</label>
			<label><input type="radio" name="activeTemplate" value="Tiger" />Tiger</label>
			<label><input type="radio" name="activeTemplate" value="Ruffian" />Ruffian</label>
			<label><input type="radio" name="activeTemplate" value="Centipede" />Centipede</label>
			<label><input type="radio" name="activeTemplate" value="Bear" />Bear</label>
			<label><input type="radio" name="activeTemplate" value="SpinningGun" />Spinning Gun</label>
			<label><input type="radio" name="activeTemplate" value="Spider" />Spider</label>
			<label><input type="radio" name="activeTemplate" value="Snake" />Snake</label>
			<label><input type="radio" name="activeTemplate" value="Scriptable" />Scriptable</label>
			<br/>

			<button id="save-game">Save</button>

			<label>Boards
				<select id="board-selector">
					<option value='jzt.newboard'>Create New Board</option>
				</select>
			</label>

		</div>

		<div id="customizers">
			<div id="template-customizer">
				<textarea id="active-template-editor" rows="10" style="width: 100%"></textarea>
			</div>
			<div id="script-customizer">
				<select id="script-selector"></select>
				<button id="new-script-button">New Script</button>
				<textarea id="script-editor" rows="20" style="width: 100%"></textarea>
			</div>
			<div id="color-customizer">
				<ol>
					<li class="color9" data-color="9">Bright&nbsp;Blue</li>
					<li class="colorA" data-color="A">Bright&nbsp;Green</li>
					<li class="colorB" data-color="B">Bright&nbsp;Cyan</li>
					<li class="colorC" data-color="C">Bright&nbsp;Red</li>
					<li class="colorD" data-color="D">Bright&nbsp;Magenta</li>
					<li class="colorE" data-color="E">Yellow</li>
					<li class="colorF" data-color="F">White</li>
				</ol>
			</div>
			<div id="other-customizers">
				<select id="mode-selector">
					<option value="0">Drawing</option>
					<option value="1">Select</option>
				</select>
			</div>
		</div>
		
		<script type="text/javascript" src="script/jzt.js"></script>
		<script type="text/javascript" src="script/board.js"></script>
		<script type="text/javascript" src="script/input.js"></script>
		<script type="text/javascript" src="script/basic.js"></script>
		<script type="text/javascript" src="script/script.js"></script>
		<script type="text/javascript" src="script/parser.js"></script>
		<script type="text/javascript" src="script/jztscript.js"></script>
		<script type="text/javascript" src="script/commands.js"></script>
		<script type="text/javascript" src="script/graphics.js"></script>
		<script type="text/javascript" src="script/things.js"></script>
		<script type="text/javascript" src="script/editor.js"></script>
		<script type="text/javascript" src="script/lz-string-1.3.3.js"></script>
		<script type="text/javascript">

			var templates = {};
			var boardSelector = document.getElementById('board-selector');
			var templateEditor = document.getElementById('active-template-editor');
			var scriptSelector = document.getElementById('script-selector');
			var newScriptButton = document.getElementById('new-script-button');
			var scriptEditor = document.getElementById('script-editor');
			var modeSelector = document.getElementById('mode-selector');
			var editArea = document.getElementById('edit-area');
			var toolBox = document.getElementById('toolbox');
			var editor = undefined;

			function onToolSelected(event) {

				var toolType = event.target.value;

				if(toolType) {

					var activeTemplate;

					if(templates.hasOwnProperty(toolType)) {
						activeTemplate = templates[toolType];
					}
					else {
						activeTemplate = {type: toolType};
						switch(toolType) {
							case 'Passage': 
								activeTemplate.passageId = 1;
								activeTemplate.targetBoard = 'Untitled';
								break;
							case 'Spider':
								activeTemplate.under = new jzt.things.SpiderWeb().serialize();
								break;
							case 'Scriptable':
								activeTemplate.script = 'Untitled Script';
								break;
							case 'River':
								activeTemplate.direction = 'N';
								break;
						}
						templates[toolType] = activeTemplate;
					}

					editor.setActiveTemplate(activeTemplate);

				}
				else {
					editor.setActiveTemplate(undefined);
				}
			};

			function onBoardSelected(event) {
				var newName;
				var width;
				var height;

				if(event.target.value === 'jzt.newboard') {
					newName = window.prompt('Please enter a board name.', 'Untitled');
					width = parseInt(window.prompt('Please enter a board width.', '40'));
					height = parseInt(window.prompt('Please enter a board height.', '20'));
					if(newName && width && height) {
						newName = editor.getUniqueBoardName(newName);
						editor.addBoard(newName, width, height);
					}
				}
				else {
					editor.switchBoard(event.target.value);
				}

			};

			function onBoardAdded(boardName) {
				boardSelector.options[boardSelector.options.length] = new Option(boardName, boardName);
			};

			function onBoardRemoved(boardName) {

			};

			function onModeChanged(mode) {
				if(parseInt(modeSelector.value) !== mode) {
					modeSelector.value = mode.toString();
				}
			};

			function onBoardChanged(boardName) {
				boardSelector.value = boardName;
				scriptSelector.options.length = 0;
				for(var index = 0; index < editor.currentBoard.scripts.length; ++index) {
					scriptSelector.options[index] = new Option(editor.currentBoard.scripts[index].name);
				}
				selectScript(scriptSelector.value);
				
			};

			function onTemplateChanged(newTemplate) {

				var element;

				if(newTemplate) {
					templateEditor.value = JSON.stringify(newTemplate, undefined, 4);

					if(newTemplate.type) {
						element = toolBox.querySelector('input[value="' + newTemplate.type + '"]');
						if(element) {
							element.checked = true;
						}
					}

				}
				else {
					templateEditor.value = '(None)';
					toolBox.querySelector('input[value=""]').checked = true;
				}

			};

			function onTemplateEdited() {
				if(templateEditor.value !== '') {
					editor.setActiveTemplate(JSON.parse(templateEditor.value));
				}
			};

			function saveGame(event) {
				editor.save();
				alert('Game Saved!');
			};

			function selectScript(scriptName) {
				var script = editor.currentBoard.getScript(scriptName);
				if(script) {
					scriptEditor.value = script.rawScript;
				}
				else {
					scriptEditor.value = '';
				}
			}

			function onScriptSelected(event) {
				selectScript(event.target.value);
			};

			function onNewScriptClick(event) {
				var newName = window.prompt('Please enter a script name.', 'Untitled');
				var script;
				if(newName) {
					newName = editor.getUniqueScriptName(newName);
					script = new jzt.Script({'name': newName, 'rawScript': ''});
					editor.currentBoard.scripts.push(script);
					scriptSelector.options[scriptSelector.options.length] = new Option(newName);
					scriptEditor.value = editor.currentBoard.getScript(newName).rawScript;
					scriptSelector.value = newName;
				}
			};

			function onScriptChanged(event) {
				var script = editor.currentBoard.getScript(scriptSelector.value);
				script.rawScript = scriptEditor.value;
			};

			function onColorSelected(event) {
				var color = event.target.dataset['color'];
				editor.setTemplateForeground(jzt.colors.getColor(color));
			};

			function onModeSelected(event) {
				var mode = parseInt(modeSelector.value);
				editor.setMode(mode);
			};

			var tools = document.getElementsByName('activeTemplate');
			for( var index = 0; index < tools.length; index++ ) {
        		tools[index].addEventListener('change', onToolSelected, false);
    		}	

    		var colors = document.getElementById('color-customizer').getElementsByTagName('li');
    		for(var index = 0; index < colors.length; ++index) {
    			colors[index].addEventListener('click', onColorSelected, false);
    		}

    		var saveButton = document.getElementById('save-game');
    		saveButton.addEventListener('click', saveGame, false);

			var callbacks = {
				addBoard: onBoardAdded,
				removeBoard: onBoardRemoved,
				changeBoard: onBoardChanged,
				changeTemplate: onTemplateChanged,
				changeMode: onModeChanged
			};

			editor = new jzt.Editor(editArea, callbacks);

			modeSelector.addEventListener('change', onModeSelected, false);
			boardSelector.addEventListener('change', onBoardSelected, false);
			templateEditor.addEventListener('blur', onTemplateEdited, false);
			scriptSelector.addEventListener('change', onScriptSelected, false);
			newScriptButton.addEventListener('click', onNewScriptClick, false);
			scriptEditor.addEventListener('blur', onScriptChanged, false);


		</script>
		
	</body>
</html>