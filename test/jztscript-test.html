<!DOCTYPE html>
<head>
	<title>JZTScript Test</title>
    <link rel="stylesheet" href="qunit.css">
</head>
<body>
	
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <script src="qunit.js"></script>
    <script type="text/javascript" src="../script/lexer.js"></script>
    <script type="text/javascript" src="../script/parser.js"></script>
    <script type="text/javascript" src="../script/script.js"></script>
    <script type="text/javascript" src="../script/graphics.js"></script>
    <script type="text/javascript" src="../script/jzt-script-commands.js"></script>
    <script type="text/javascript" src="../script/jzt-script.js"></script>
    
	<script type="text/javascript">
        
        var JztScriptParser = jzt.jztscript.JztScriptParser;
        var JztScript = jzt.jztscript.JztScript;
        var commands = jzt.jztscript.commands;
        var NEWLINE_ERROR = /Unexpected token \'\[New Line\]\'/;
        
        test('Label', function(){
            var parser = new JztScriptParser();
            ok(parser.parse(':labelone\n:labeltwo') instanceof JztScript, ':labelone');
            throws(function(){parser.parse(':labelone two');}, /Unexpected token \'two\'/, ':labelone two');
        });
        
        test('Empty statements', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('\n\n\n') instanceof JztScript, 'three newlines');
            ok(parser.parse('') instanceof JztScript, 'empty script');
        });
        
        test('Comments', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('// This is a comment line') instanceof JztScript, 'Single comment');
            ok(parser.parse('// Comment\n:label') instanceof JztScript, 'Comment followed by statement');
            ok(parser.parse(':label // Trailing comment') instanceof JztScript, 'Trailing comment');
        });
        
        test('Become statement', function(){
            var parser = new JztScriptParser();
            var command;
            ok(parser.parse('become fakewall') instanceof JztScript, 'become fakewall');
            ok(parser.parse('become blue snake') instanceof JztScript, 'become blue snake');
            throws(function(){parser.parse('become teal something')}, /Unexpected token \'teal\'/, 'become teal something');
            throws(function(){parser.parse('become red cactus')}, /Unexpected token \'cactus\'/, 'become red cactus');
            throws(function(){parser.parse('become blue red fakewall')}, /Unexpected token \'red\'/, 'become blue red fakewall');
            throws(function(){parser.parse('become red fakewall otter')}, /Unexpected token \'otter\'/, 'become red fakewall otter');
            throws(function(){parser.parse('become red')}, NEWLINE_ERROR, 'become red');
            
            result = parser.parse('become blue snake');
            command = result.getCommand(0);
            ok(command instanceof commands.BecomeCommand, 'Expecting BecomeCommand');
            ok(command.template.color === jzt.colors.Blue, 'Expecting Blue');
            ok(command.template.id === 'snake', 'Expecting Snake');
            
        });
        
        test('Change Statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('change fakewall linewall') instanceof JztScript, 'change fakewall linewall');
            ok(parser.parse('change blue fakewall linewall') instanceof JztScript, 'change blue fakewall linewall');
            ok(parser.parse('change fakewall blue linewall') instanceof JztScript, 'change fakewall blue linewall');
            ok(parser.parse('change blue fakewall red linewall') instanceof JztScript, 'change blue fakewall red linewall');
            throws(function(){parser.parse('change fakewall blah')}, /Unexpected token \'blah\'/, 'change fakewall blah');
            throws(function(){parser.parse('change blah linewall')}, /Unexpected token \'blah\'/, 'change blah linewall');
            throws(function(){parser.parse('change blue fakewall blah')}, /Unexpected token \'blah\'/, 'change blue fakewall blah');
            throws(function(){parser.parse('change blue fakewall teal linewall')}, /Unexpected token \'teal\'/, 'change blue fakewall teal linewall');
            throws(function(){parser.parse('change blue fakewall')}, NEWLINE_ERROR, 'change blue fakewall');
            throws(function(){parser.parse('change blue red')}, /Unexpected token \'red\'/, 'change blue red');
        });
        
        test('Char statement', function() {
            var parser = new JztScriptParser();
            ok(parser.parse('char 50') instanceof JztScript, 'char 50');
            throws(function(){parser.parse('char')}, NEWLINE_ERROR, 'char');
        });
        
        test('Die statement', function() {
            var parser = new JztScriptParser();
            ok(parser.parse('die') instanceof JztScript, 'die');
            ok(parser.parse('die magnetically') instanceof JztScript, 'die magnetically');
            throws(function(){parser.parse('die red')}, /Unexpected token \'red\'/, 'die red');
            throws(function(){parser.parse('die 5')}, /Unexpected token \'5\'/, 'die 5');
        });
        
        test('End statement', function() {
            var parser = new JztScriptParser();
            ok(parser.parse('end') instanceof JztScript, 'end');
            throws(function(){parser.parse('end 5')}, /Unexpected token \'5\'/, 'end 5');
        });
        
        test('Give statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('give 5 gems') instanceof JztScript, 'give 5 gems');
            ok(parser.parse('give 25 torches') instanceof JztScript, 'give 25 torches');
            throws(function(){parser.parse('give red gems')}, /Unexpected token \'red\'/, 'give red gems');
            throws(function(){parser.parse('give 5 gems label')}, /Unexpected token \'label\'/, 'give 5 gems label');
            throws(function(){parser.parse('give 25')}, NEWLINE_ERROR, 'give 25');
            throws(function(){parser.parse('give gems')}, /Unexpected token \'gems\'/, 'give gems');
            throws(function(){parser.parse('give')}, NEWLINE_ERROR, 'give');
        });
        
        test('If statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('if gems <= 5 dosomething') instanceof JztScript, 'if gems <= 5 dosomething');
            ok(parser.parse('if gems = 25 somethingelse') instanceof JztScript, 'if gems = 25 somethingelse');
            ok(parser.parse('if torches < 60 blah') instanceof JztScript, 'if torches < 60 blah');
            ok(parser.parse('if ammo >= 25 blahblah') instanceof JztScript, 'if ammo >= 25 blahblah');
            ok(parser.parse('if neato > 2 neat') instanceof JztScript, 'if neato > 2 neat');
            ok(parser.parse('if not gems <= 5 dosomething') instanceof JztScript, 'if not gems <= 5 dosomething');
            ok(parser.parse('if adjacent dosomething') instanceof JztScript, 'if adjacent dosomething');
            ok(parser.parse('if blocked north dosomething') instanceof JztScript, 'if blocked north dosomething');
            ok(parser.parse('if blocked cw ccw rndp opp rndne dosomething') instanceof JztScript, 'if blocked cw ccw rndp opp rndne dosomething');
            ok(parser.parse('if aligned south dosomething') instanceof JztScript, 'if aligned south dosomething');
            ok(parser.parse('if aligned ccw cw opp rndp flow dosomething') instanceof JztScript, 'if aligned ccw cw opp rndp flow dosomething');
            ok(parser.parse('if peep 5 dosomething') instanceof JztScript, 'if peep 5 dosomething');
            ok(parser.parse('if exists fakewall dosomething') instanceof JztScript, 'if exists fakewall dosomething');
            ok(parser.parse('if exists blue lion dosomething') instanceof JztScript, 'if exists blue lion dosomething');
            ok(parser.parse('if exists 5 fakewall dosomething') instanceof JztScript, 'if exists 5 fakewall dosomething');
            ok(parser.parse('if exists 5 blue linewall dosomething') instanceof JztScript, 'if exists 5 blue linewall dosomething');
            ok(parser.parse('if not exists 10 red lion dosomething') instanceof JztScript, 'if not exists 10 red lion dosomething');
            ok(parser.parse('if not not not not gems < 5 dosomething') instanceof JztScript, 'if not not not not gems < 5 dosomething');
            throws(function(){parser.parse('if 5 gems dosomething')}, /Unexpected token \'5\'/, 'if 5 gems dosomething');
            throws(function(){parser.parse('if gems < five dosomething')}, /Unexpected token \'five\'/, 'if sems < five dosomething');
        });
        
        test('Lock statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('lock') instanceof JztScript, 'lock');
            throws(function(){parser.parse('lock blah')}, /Unexpected token \'blah\'/, 'lock blah');
        });
        
        test('Move statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('move north') instanceof JztScript, 'move north');
            ok(parser.parse('move north otherwise dosomething') instanceof JztScript, 'move north otherwise dosomething');
            ok(parser.parse('move s forcefully') instanceof JztScript, 'move s forcefully');
            ok(parser.parse('move e 5') instanceof JztScript, 'move e 5');
            ok(parser.parse('move e 5 forcefully') instanceof JztScript, 'move e 5 forcefully');
            ok(parser.parse('move e 10 otherwise dosomething') instanceof JztScript, 'move e 10 otherwise dosomething');
            ok(parser.parse('move cw opp rndp ccw w') instanceof JztScript, 'move cw opp rndp ccw w');
            ok(parser.parse('move ccw rndne forcefully') instanceof JztScript, 'move ccw rndne forcefully');
            ok(parser.parse('move opp flow otherwise dosomething') instanceof JztScript, 'move opp flow otherwise dosomething');
            ok(parser.parse('move opp flow 25 otherwise dosomething') instanceof JztScript, 'move 25 opp flow otherwise dosomething');
        });
        
        test('Play statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('play "cdefgabc"') instanceof JztScript, 'play "cdefgabc"');
            throws(function(){parser.parse('play north')}, /Unexpected token \'north\'/, 'play north');
            throws(function(){parser.parse('play abcdefg')}, /Unexpected token \'abcdefg\'/, 'play abcdefg');
        });
        
        test('Put statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('put north fakewall') instanceof JztScript, 'put north fakewall');
            ok(parser.parse('put cw rndp s fakewall') instanceof JztScript, 'put cw rndp s fakewall');
            ok(parser.parse('put cw rndp ccw e red fakewall') instanceof JztScript, 'put cw rndp ccw e red fakewall');
            throws(function(){parser.parse('put cw rndp ccw red fakewall')}, /Unexpected token \'red\'/, 'put cw rndp ccw red fakewall');
            throws(function(){parser.parse('put fakewall')}, /Unexpected token \'fakewall\'/, 'put fakewall');
            throws(function(){parser.parse('put e')}, NEWLINE_ERROR, 'put e');
        });
        
        test('Scroll statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('scroll "Hello, World!"') instanceof JztScript, 'scroll "Hello, World!"');
            ok(parser.parse('scroll bold "Hello, World!"') instanceof JztScript, 'scroll bold "Hello, World!"');
            ok(parser.parse('scroll "Hello, World!" something') instanceof JztScript, 'scroll "Hello, World!" something');
            ok(parser.parse('scroll bold "Hello, World!" something') instanceof JztScript, 'scroll bold "Hello, World!" something');
            throws(function(){parser.parse('scroll Hello, World!')}, /Unrecognized token/, 'scroll Hello, World!');
            throws(function(){parser.parse('scroll Hello World')}, /Unexpected token \'Hello\'/, 'scroll Hello World');
        });
        
        test('Send Statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('send bob dosomething') instanceof JztScript, 'send bob dosomething');
            ok(parser.parse('send self dosomething') instanceof JztScript, 'send self dosomething');
            throws(function(){parser.parse('send dosomething')}, NEWLINE_ERROR, 'send dosomething');
        });
        
        test('Set Statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('set flag') instanceof JztScript, 'set flag');
            ok(parser.parse('set 5 something') instanceof JztScript, 'set 5 something');
            throws(function(){parser.parse('set')}, NEWLINE_ERROR, 'set');
            throws(function(){parser.parse('set five something')}, /Unexpected token \'something\'/, 'set five something');
        });
        
        test('Take Statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('take 5 gems toopoor') instanceof JztScript, 'take 5 gems toopoor');
            ok(parser.parse('take 10 something') instanceof JztScript, 'take 10 something');
            throws(function(){parser.parse('take something')}, /Unexpected token \'something\'/, 'take something');
            throws(function(){parser.parse('take 1 gems 3')}, /Unexpected token \'3\'/, 'take 1 gems 3');
            throws(function(){parser.parse('take 5 gems toopoor gems')}, /Unexpected token \'gems\'/, 'take 5 gems toopoor gems');
        });
        
        test('ThrowStar Statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('throwstar north') instanceof JztScript, 'throwstar north');
            ok(parser.parse('throwstar cw ccw opp seek') instanceof JztScript, 'throwstar cw ccw opp seek');
            throws(function(){parser.parse('throwstar')}, NEWLINE_ERROR, 'throwstar');
        });
        
        test('Torch Statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('torch 5') instanceof JztScript, 'torch 5');
            ok(parser.parse('torch') instanceof JztScript, 'torch');
            throws(function(){parser.parse('torch five')}, /Unexpected token \'five\'/, 'torch five');
        });
            
        test('Restore statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('restore labelname') instanceof JztScript, 'restore labelname');
            throws(function(){parser.parse('restore')}, NEWLINE_ERROR, 'restore');
        });
            
        test('Say statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('say "Something interesting, joe!"') instanceof JztScript, 'say "Something intersting, joe!"');
            throws(function(){parser.parse('say something')}, /Unexpected token \'something\'/, 'say something');
            throws(function(){parser.parse('say')}, NEWLINE_ERROR, 'say');
            throws(function(){parser.parse('say "unterminated string')}, /Unterminated string literal/, 'say "unterminated string');
        });
        
        test('Shoot statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('shoot north') instanceof JztScript, 'shoot north');
            ok(parser.parse('shoot cw ccw opp flow') instanceof JztScript, 'shoot cw ccw opp flow');
            throws(function(){parser.parse('shoot red')}, /Unexpected token \'red\'/, 'shoot red');
            throws(function(){parser.parse('shoot')}, NEWLINE_ERROR, 'shoot');
        });
        
        test('Stand statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('stand') instanceof JztScript, 'stand');
            throws(function(){parser.parse('stand north')}, /Unexpected token \'north\'/, 'stand north');
        });
        
        test('Unlock statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('unlock') instanceof JztScript, 'unlock');
            throws(function(){parser.parse('unlock something')}, /Unexpected token \'something\'/, 'unlock something');
        });
        
        test('Wait statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('wait 5') instanceof JztScript, 'wait 5');
            ok(parser.parse('wait') instanceof JztScript, 'wait');
            throws(function(){parser.parse('wait for something')}, /Unexpected token \'for\'/, 'wait for something');
        });
        
        test('Walk statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('walk north') instanceof JztScript, 'walk north');
            ok(parser.parse('walk cw ccw opp seek') instanceof JztScript, 'walk cw ccw opp seek');
            throws(function(){parser.parse('walk')}, NEWLINE_ERROR, 'walk');
            throws(function(){parser.parse('walk red')}, /Unexpected token \'red\'/, 'walk red');
        });

        test('Zap statement', function(){
            var parser = new JztScriptParser();
            ok(parser.parse('zap target') instanceof JztScript, 'zap target');
            throws(function(){parser.parse('zap')}, NEWLINE_ERROR, 'zap');
        });
        
        test('Multi-line script', function(){
            var parser = new JztScriptParser();
            ok(parser.parse(':label\nwait 5\nwalk cw ccw seek\nmove rndp ccw n\nif aligned south label2\nend\n:label2\nsay "Interesting!"\nend') instanceof JztScript, 'Full sript');
        });
        
	</script>
	
</body>