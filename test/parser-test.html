<!DOCTYPE html>
<head>
	<title>Collection Parser Test</title>
</head>
<body>
	
	<script type="text/javascript" src="../script/parser.js"></script>
	
	<script type="text/javascript">
		
		// Sequence
		var s = new jzt.parser.Sequence();
		s.add(new jzt.parser.Number());
		s.add(new jzt.parser.Word());
		
		var a = new jzt.parser.Assembly('100 hello');
		var result = s.bestMatch(a);
		console.assert(result.tokens.length == 2);
		console.assert(result.tokens[0] == '100');
		console.assert(result.tokens[1] == 'hello');
		console.assert(result.stack[0] == '100');
		console.assert(result.stack[1] == 'hello');
		
		a = new jzt.parser.Assembly('hello 100');
		result = s.bestMatch(a);
		console.assert(result == undefined);
		
		a = new jzt.parser.Assembly('100 hello world');
		result = s.bestMatch(a);
		console.assert(result.tokens.length == 3);
		console.assert(result.stack.length == 2);
		console.assert(result.stack[0] == '100');
		console.assert(result.stack[1] == 'hello');
		console.assert(result.index == 2);
		
		a = new jzt.parser.Assembly('100 200');
		try {
			result = s.bestMatch(a);
			console.assert(false);
		}
		catch(ex) {
			console.assert(ex == 'Unexpected token \'200\'');
		}
		
		a = new jzt.parser.Assembly('100');
		try {
			result = s.bestMatch(a);
			console.assert(false);
		}
		catch(ex) {
			console.assert(ex == 'Token expected');
		}
		
		// Repetition
		var r = new jzt.parser.Repetition(new jzt.parser.Word());
		
		a = new jzt.parser.Assembly('hello world this is Mark');
		result = r.bestMatch(a);
		console.assert(result.tokens.length == 5);
		console.assert(result.stack.length == 5);
		
		a = new jzt.parser.Assembly('Hello world this is 100 Marks');
		result = r.bestMatch(a);
		console.assert(result.tokens.length == 6);
		console.assert(result.stack.length == 4);
		console.assert(result.stack[0] == 'Hello');
		console.assert(result.stack[1] == 'world');
		console.assert(result.stack[2] == 'this');
		console.assert(result.stack[3] == 'is');
		
		// Alternation
		var alt = new jzt.parser.Alternation();
		alt.add(new jzt.parser.Literal("hello"));
		alt.add(new jzt.parser.Literal("world"));
		alt.add(new jzt.parser.Literal("!"));
		
		a = new jzt.parser.Assembly('hello');
		result = alt.bestMatch(a);
		console.assert(result.tokens.length == 1);
		console.assert(result.stack.length == 1);
		console.assert(result.stack[0] == 'hello');
		
		a = new jzt.parser.Assembly('world');
		result = alt.bestMatch(a);
		console.assert(result.tokens.length == 1);
		console.assert(result.stack.length == 1);
		console.assert(result.stack[0] == 'world');
		
		a = new jzt.parser.Assembly('!');
		result = alt.bestMatch(a);
		console.assert(result.tokens.length == 1);
		console.assert(result.stack.length == 1);
		console.assert(result.stack[0] == '!');
		
		a = new jzt.parser.Assembly('mark');
		result = alt.bestMatch(a);
		console.assert(result == undefined);
		
		// Repetition of Alternation
		r = new jzt.parser.Repetition(alt);
		
		a = new jzt.parser.Assembly('hello world!');
		result = r.bestMatch(a);
		console.assert(result.tokens.length == 3);
		console.assert(result.stack.length = 3);
		console.assert(result.stack[0] == 'hello');
		console.assert(result.stack[1] == 'world');
		console.assert(result.stack[2] == '!');
		
		a = new jzt.parser.Assembly('world! !! hello !world hello!');
		result = r.bestMatch(a);
		console.assert(result.tokens.length == 9);
		console.assert(result.stack.length == 9);
		console.assert(result.stack[0] == 'world');
		console.assert(result.stack[1] == '!');
		console.assert(result.stack[2] == '!');
		console.assert(result.stack[3] == '!');
		console.assert(result.stack[4] == 'hello');
		console.assert(result.stack[5] == '!');
		console.assert(result.stack[6] == 'world');
		console.assert(result.stack[7] == 'hello');
		console.assert(result.stack[8] == '!');
		
		a = new jzt.parser.Assembly('hello world mark!');
		result = r.bestMatch(a);
		console.assert(result.tokens.length == 4);
		console.assert(result.stack.length = 2);
		console.assert(result.stack[0] == 'hello');
		console.assert(result.stack[1] == 'world');
		
		a = new jzt.parser.Assembly('I said hello world!');
		result = r.bestMatch(a);
		console.assert(result.tokens.length == 5);
		console.assert(result.stack.length == 0);
		
		a = new jzt.parser.Assembly('!');
		result = r.bestMatch(a);
		console.assert(result.tokens.length == 1);
		console.assert(result.stack.length == 1);
		console.assert(result.stack[0] == '!');
		
		console.info("All done!");
	
	</script>
	
</body>